From 93f908408477c140051330d7fd0140d9e9a24312 Mon Sep 17 00:00:00 2001
From: Michal Vasilek <michal.vasilek@nic.cz>
Date: Mon, 7 Nov 2022 14:22:24 +0100
Subject: [PATCH] Revert "backend/turris1x: remove broken wlan* pci detection"

fixes reader_loop: bad jump: 8388608 error

This reverts commit 96500e1b0f3e3f4175511d3a7e633cc5c4d8c603.
---
 backend/turris1x/backend.sh | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/backend/turris1x/backend.sh b/backend/turris1x/backend.sh
index d973ed3..3f8013c 100644
--- a/backend/turris1x/backend.sh
+++ b/backend/turris1x/backend.sh
@@ -61,6 +61,16 @@ set_led() {
 			power)
 				mode="enable"
 				;;
+			wlan*)
+				local trigger
+				loadsrc pci
+				if trigger="$(pci_device_activity_detect "$led" "/sys/bus/pci/devices/0000:0${led#pci}:00.0")"; then
+					mode="activity"
+					set "$trigger"
+				else
+					mode="disable"
+				fi
+				;;
 		esac
 	fi
 
-- 
2.38.1

